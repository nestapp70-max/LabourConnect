// Prisma uses PostgreSQL by default on Render
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//
// ===================================
// USER MODEL (from your Mongoose schema)
// ===================================
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role

  jobs          Job[]
  bids          Bid[]
  chats         Chat[]
  messages      Message[]
  payments      Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  customer
  technician
}

//
// ===================================
// JOB MODEL (guessed based on marketplace logic)
// ===================================
model Job {
  id          String    @id @default(cuid())
  title       String
  description String
  price       Float
  category    String

  customer    User      @relation(fields: [customerId], references: [id])
  customerId  String

  technician  User?     @relation(fields: [technicianId], references: [id])
  technicianId String?

  bids       Bid[]
  chats      Chat[]

  status     JobStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum JobStatus {
  PENDING
  ASSIGNED
  COMPLETED
  CANCELLED
}

//
// ===================================
// BID MODEL (your place-bid modal needs this)
// ===================================
model Bid {
  id          String   @id @default(cuid())
  amount      Float
  message     String?

  user        User     @relation(fields: [userId], references: [id])
  userId      String

  job         Job      @relation(fields: [jobId], references: [id])
  jobId       String

  createdAt DateTime @default(now())
}

//
// ===================================
// CHAT + MESSAGE MODELS
// (based on your chat.socket.ts structure)
// ===================================
model Chat {
  id        String    @id @default(cuid())

  job       Job       @relation(fields: [jobId], references: [id])
  jobId     String

  user1     User      @relation("User1Chats", fields: [user1Id], references: [id])
  user1Id   String

  user2     User      @relation("User2Chats", fields: [user2Id], references: [id])
  user2Id   String

  messages  Message[]
  createdAt DateTime  @default(now())
}

model Message {
  id        String   @id @default(cuid())
  text      String

  chat      Chat     @relation(fields: [chatId], references: [id])
  chatId    String

  sender    User     @relation(fields: [senderId], references: [id])
  senderId  String

  createdAt DateTime @default(now())
}

//
// ===================================
// PAYMENT MODEL (from your Razorpay logic)
// ===================================
model Payment {
  id              String   @id @default(cuid())
  orderId         String
  paymentId       String
  status          String

  user            User     @relation(fields: [userId], references: [id])
  userId          String

  createdAt DateTime @default(now())
}
